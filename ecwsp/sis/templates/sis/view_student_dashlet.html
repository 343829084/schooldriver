{% extends "responsive_dashboard/dashlet.html" %}

{% block dashlet_header %}
  <form id="form_view_student_dashlet" class="view_student" action="/sis/view_student/" method="post">
    {% if perms.sis.change_student %}
       <a href="{% url 'admin:sis_student_changelist' %}">Student Flashcard</a>
    {% else %}
      Student Flashcard
    {% endif %}
<!-- Below this comment is the fancy auto-complete search function - Jeff -->
    <!--br tag to separate search from student? see mockup-->
    <br>
    {% csrf_token %}
    <span class="field">
      <input class="input" type="text" placeholder="Search for student" name="view_student_dashlet_text" id="id_view_student_dashlet_text" style="width:15em" value="" maxlength="255" autocomplete="off" role="textbox" aria-autocomplete="list" aria-haspopup="true">
  </span>
    <input type="hidden" name="student" id="id_view_student_dashlet" value="">
    <div id="id_view_student_dashlet_on_deck" style="display: none;" class="results_on_deck"><div></div></div>
    <script>
        $('#id_view_student_dashlet_text').yourlabsAutocomplete({
            url: '/autocomplete/StudentLookupStudentAutocomplete/',
            choiceSelector: 'a',
            box: $('<span class="yourlabs-autocomplete autocomplete-lookup-student-dashlet"></span>'),
            fixPosition: function() {
              // Insert the autocomplete container after the input.
              var pos = $.extend({}, this.input.position(), {
                  height: this.input.outerHeight(),
                  width:  this.input.outerWidth()
              });

              this.input.parents().filter(function() {
                  return $(this).css('overflow') === 'hidden';
              }).first().css('overflow', 'visible');

              this.box.insertAfter(this.input).css(
                      {top: pos.top + pos.height, left: pos.left, "min-width": pos.width });
            }
        }).input.bind('selectChoice', function(e, choice, autocomplete) {
            $('#blarg').show();
            $('#blarg-name').text("Nameeeeeee: "+choice.first_name);
        });
    </script>
  </form>
{% endblock %}

{% block dashlet_body %}
  <!-- Something to try: span the entire width w/ "Search for a student..." then split into parts when student has been searched.
      Make it look clean, like the mockup -->
  <div>
   {% if not object %}
    <p>Search for a student to<br>get a photo and info</p>
   {% endif %}
  </div> 
  <div id="blarg" style="display: none;">
    <div style="width: 55%; float:left;">
      <img style="width: 100%; max-width: 530px;" src="{{ student.pic.url_530x400 }}"/>
    </div>
    <div style="width:45%; float:left; text-align: left;">
     
     <!-- added left side padding to name/year -->
     <p style="padding-top: 1.75em; padding-left: .75em; padding-bottom: 1.75em;">
      <div id="blarg-name">Name: {% if object %}{{ object }}{% endif %}</div>
      <div id="blarg-year">Year: {% if object %}{{ object.year }}{% endif %}</div>
      <div id="blarg-cohort">Cohort: {% if object %}{{ object.primary_cohort }}{% endif %}</div>
     </p>
     <div class="primary btn">
      <a href="{% if object %}{% url "ecwsp.sis.views.view_student" object.id %}{% endif %}">View Info</a>
     </div>
     
    </div>
  </div>
{% endblock %}

{% block dashlet_footer %}
{% endblock %}
