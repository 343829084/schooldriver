{% extends 'application_base.html' %}
{% load staticfiles %}
{% load static from staticfiles %}
{% block extra_head %}
<script type="text/javascript" src="{% static 'js/admissions/student_application.js' %}"></script>
{% endblock %}

{% block content %}
{% verbatim %}

<div class="container custom-application" ng-app="admissions" ng-controller="StudentApplicationController" ng-init="init()">
  <div ng-if="applicationNotComplete()">
    <h1>
      Application For Admission
      <p class="lead">Click on each section title and fill out all fields for each section</p>
    </h1>
    <hr>
    <form name="applicationForm" novalidate class="form-horizontal">
      <div class="panel-group" id="accordion">
        <div class="panel panel-default" ng-repeat="section in application_template.sections" ng-form="nestedForm">
          <div class="panel-heading">
              <h4>
                <a data-toggle="collapse" data-parent="#accordion" href="#section-{{section.id}}">
                  {{ section.name }}
                </a>
              </h4>
            <span ng-if="nestedForm.$invalid" class="text-danger">
                <i class="fa fa-exclamation-triangle"></i> <em>Required fields empty!</em>
            </span>
          </div>
          <div id="section-{{section.id}}" class="panel-collapse collapse">
            <div class="panel-body">
              <p>{{ section.help_text }}</p>
              <div class="col-sm-12">
                <div>
                  <div ng-repeat="section_field in section.fields track by $index" ng-form="nestedField">
                    <div class="form-group col-sm-12" ng-class="{'has-error' : nestedField.$invalid}">
                      <label class="control-label col-sm-2" ng-if="section_field.field_label.length < 50">
                        {{ section_field.field_label }}
                      </label>
                      <label class="control-label col-sm-10 col-sm-offset-2" ng-if="section_field.field_label.length > 50">
                        <p class="text-left">{{ section_field.field_label }}</p>
                      </label>
                      <div class="col-sm-2" ng-if="section_field.field_label.length > 50"></div>
                      <div class="col-sm-10" >
                        <input 
                          ng-if="section_field.field_type == 'input'" 
                          name="{{ section_field.field_name }}" 
                          type="text" 
                          class="form-control" 
                          ng-model="section_field.value" 
                          ng-required="section_field.required" >
                        <textarea 
                          ng-if="section_field.field_type == 'textarea'" 
                          name="{{ section_field.field_name }}" 
                          class="form-control" 
                          rows="5" 
                          ng-model="section_field.value" 
                          ng-required="section_field.required">
                        </textarea>
                        <select 
                          ng-if="section_field.field_type == 'multiple'" 
                          name="{{ section_field.field_name }}" 
                          class="form-control" 
                          ng-model="section_field.value" 
                          ng-required="section_field.required">
                            <option ng-repeat="choice in section_field.choices track by $index" value="{{ choice.value }}">{{ choice.display_name }}</option>
                        </select>
                        <span ng-if="nestedField.$invalid"  class="text-danger"><em>This field is required</em></span>
                        <span class="help-block">
                          {{ section_field.helptext }}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div ng-if="applicationForm.$invalid" class="text-danger">
        <p>You will not be able to submit this application until all required fields have been completed</p>
      </div>
      <div ng-if="submissionError.status == true" >
        <h3>Please correct the following errors and submit your application again</h3>
        <p ng-repeat="error in submissionError.errors">
          <strong>{{ error.field_label }}</strong>: <em class="text-danger">{{ error.error_msg }}</em>
        </p>
      </div>
      <button class="btn btn-success btn-lg" ng-click="submitApplication()" ng-disabled="applicationForm.$invalid">Submit Application</button>
    </form>
  </div>
  <div ng-if="applicationComplete">
    <button onclick="window.print()" class="hidden-print pull-right btn btn-lg btn-primary">
      <i class="fa fa-print"></i> Print
    </button>
    <h1 class="hidden-print">Application Complete!</h1>
    <p class="lead hidden-print">Please review and print out your completed application for your own records</p>
    <div ng-repeat="section in application_template.sections" class="col-xs-12">
      <h4>{{ section.name }}</h4>
      <hr>
      <div ng-repeat="section_field in section.fields track by $index" class="col-xs-12">
        <div class="col-xs-3">
          <strong>{{ section_field.field_label }}</strong>
        </div>
        <div class="col-xs-9">
          {{ section_field.value }}
        </div>
      </div>
    </div>
  </div>
</div>

{% endverbatim %}
{% endblock %}
