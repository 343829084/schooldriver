"use strict";angular.module("gradeBookApp",["ngRoute","ngResource","ngCookies","ui.bootstrap","ngHandsontable","gradeBookApp.controllers","gradeBookApp.services","gradeBookApp.templates"]).config(["$provide","$routeProvider",function(a,b){a.factory("appConfig",function(){return{apiUrl:"http://192.168.59.103:8000/api/"}}),b.when("/students/classSections",{controller:"classSectionListCtrl",templateUrl:"studentGrades/classSectionList/classSectionList.html"}).when("/students/classSections/:sectionId",{controller:"singleSectionCtrl",templateUrl:"studentGrades/singleSection/singleSection.html"}).otherwise({redirectTo:"/students/classSections"})}]).run(["$http","$cookies",function(a,b){a.defaults.headers.common["X-CSRFToken"]=b.csrftoken}]),angular.module("gradeBookApp.services",[]),angular.module("gradeBookApp.controllers",[]),angular.module("gradeBookApp.controllers").controller("classSectionListCtrl",["$scope","classSectionFactory","sectionFactory","$log",function(a,b,c){a.classSectionList=[],a.select={},a.years=[],a.teachers=["Teacher 1","Teacher 2","Teacher 3"],a.$watch("select.teacher",function(){a.select.year&&a.select.teacher&&e()}),a.$watch("select.year",function(){a.select.year&&a.select.teacher&&e()});var d=function(){for(var b=2e3,c=2015;c>b;b++)a.years.push(b)};d();var e=function(){c.get().$promise.then(function(a){console.log(a)})}}]),angular.module("gradeBookApp.controllers").controller("singleSectionCtrl",["$scope","classSectionFactory","assignmentFactory","gradeFactory","studentFactory","$routeParams","$modal","$log",function(a,b,c,d,e,f,g,h){if(a.sectionId=f.sectionId,a.sectionId){a.originalDataSource=[],a.users=[],a.columns=[],a.afterChange=function(a,b){"loadData"!==b&&u(a[0])},a.afterGetColHeader=function(a,b){if(2===a){var c=m("fa fa-wrench");Handsontable.Dom.addEvent(c,"click",function(){j()}),b.firstChild.appendChild(c)}if(a>=i)if(a===v.length+i){var d=m("fa fa-plus-square");Handsontable.Dom.addEvent(d,"click",function(){k()}),b.firstChild.appendChild(d)}else{var e=m("fa fa-minus-square");Handsontable.Dom.addEvent(e,"click",function(){var b=confirm("Are you sure you want to delete assignment");b&&l(a)}),b.firstChild.appendChild(e)}};var i=3,j=function(){console.log("adjustGradeSettings");g.open({windowClass:"modal fade in active",templateUrl:"studentGrades/singleSection/_adjustGradeSettings.html",controller:"adjustGradeSettingsCtrl",resolve:{assignments:function(){return a.originalDataSource.assignments}}})},k=function(){console.log("addNewAssignment");var b=g.open({windowClass:"modal fade in active",templateUrl:"studentGrades/singleSection/_addNewAssignment.html",controller:"addNewAssignmentCtrl"});b.result.then(function(b){c.create(b).$promise.then(function(b){a.originalDataSource.assignments.push(b),x(a.originalDataSource.assignments),console.log(b),console.log(a.columns),console.log(a.originalDataSource)},function(a){h.error("singleSectionCtrl.addNewAssignment",a)})},function(){h.info("Modal dismissed at: "+new Date)})},l=function(a){var b=v[a-i];c["delete"]({assignmentId:b}).$promise.then(function(){h.log("AFTER DELETE WE SHOULD UPDATE WHOLE DATASET"),z()},function(a){h.error("singleSectionCtrl.deleteAssignment:",a)})},m=function(a){var b=document.createElement("i");return b.className=a+" button",b},n=function(){return[{data:"firstName",title:"First Name",readOnly:!0},{data:"lastName",title:"Last Name",readOnly:!0},{data:"finalGrade",title:"Final Grade",readOnly:!0}]},o=function(a){var b=a.split("assignment_")[1];return parseInt(b,10)},p=function(b,c){for(var d=0,e=a.originalDataSource.length;e>d;d++){var f=a.originalDataSource[d];if(f.id===b){f=c;break}}},q=function(b,c){for(var d=0,e=a.users.length;e>d;d++)if(a.users[d].id===b){a.users[d]=c;break}},r=function(a){e.get({studentId:a}).$promise.then(function(b){p(a,b);var c=w(b);q(a,c)},function(a){h.error("singleSectionCtrl.getSingleStudent",a)})},s=function(a,b){d.update({gradeId:a.id},a).$promise.then(function(a){console.log(a),r(b)},function(a){h.error("singleSectionCtrl.updateGrade",a)})},t=function(a,b){d.create(a).$promise.then(function(a){console.log(a),r(b)},function(a){h.error("singleSectionCtrl.addGrade",a)})},u=function(b){console.log("serveChange");var c=b[0],d=o(b[1]),e=b[2],f=b[3];if(console.log(e),console.log(f),e!=f){var g=a.originalDataSource.users[c];if(void 0===e){var h={assignmentId:d,value:parseInt(f,10)};t(h,g.id)}else for(var i=0,j=g.assignments.length;j>i;i++)if(g.assignments[i].assignmentId===d){var k=g.assignments[i];k.value=parseInt(f,10),s(k,g.id);break}}},v=[],w=function(a){for(var b={id:a.id,firstName:a.firstName,lastName:a.lastName,finalGrade:a.finalGrade},c=a.assignments,d=0,e=v.length;e>d;d++)for(var f=v[d],g=0,h=c.length;h>g;g++)c[g].assignmentId===f&&(b["assignment_"+f]=c[g].value);return b},x=function(b){v=[];for(var c=n(),d=0,e=b.length;e>d;d++)v.push(b[d].id),c.push({data:"assignment_"+b[d].id,title:b[d].name});c.push({title:"Add new assignment",readOnly:!0}),a.columns=c},y=function(b){a.originalDataSource=b,x(b.assignments);for(var c=0,d=b.users.length;d>c;c++)a.users.push(w(b.users[c]))},z=function(){console.log("getSection"),b.getBySection({sectionId:a.sectionId}).$promise.then(function(b){console.log(b),a.users=[],y(b)},function(a){h.error("singleSectionCtrl:getSection",a)})};z()}}]).controller("adjustGradeSettingsCtrl",["$scope","$modalInstance","assignments",function(a,b,c){a.assignments=c,console.log(c),a.ok=function(){b.close()},a.cancel=function(){b.dismiss()}}]).controller("addNewAssignmentCtrl",["$scope","categoryFactory","$modalInstance",function(a,b,c){a.assignment={},a.categories=[];var d=function(){b.get().$promise.then(function(b){a.categories=b},function(){})};d(),a.ok=function(){console.log(a.assignment),c.close(a.assignment)},a.cancel=function(){c.dismiss()}}]),angular.module("gradeBookApp.services").factory("assignmentFactory",["appConfig","$resource",function(a,b){return b(a.apiUrl+"/assignments/:assignmentId/ ",{assignmentId:"@assignmentId"},{create:{method:"POST"},update:{method:"PUT"}})}]),angular.module("gradeBookApp.services").factory("categoryFactory",["appConfig","$resource","$log",function(a,b,c){return b(a.apiUrl+"/categories/ ",{},{get:{method:"GET",isArray:!0,interceptor:{responseError:function(){return c.error("GET CATEGORY LIST"),[{id:1,name:"Category 1"},{id:2,name:"Category 2"},{id:3,name:"Category 3"}]}}}})}]),angular.module("gradeBookApp.services").factory("classSectionFactory",["appConfig","$resource","$log",function(a,b,c){return b(a.apiUrl+"/classSection/:sectionId/ ",{sectionId:"@sectionId"},{getBySection:{method:"GET",interceptor:{responseError:function(a){return c.error("GET USER LIST WITH ASSIGNMENTS:",a),{id:1,assignments:[{id:1,name:"Quiz",weight:25,category:1},{id:2,name:"Midterm",weight:50,category:2},{id:3,name:"Project",weight:15,category:3}],users:[{id:1,firstName:"Ashor",lastName:"Lior",finalGrade:0,assignments:[{id:1,assignmentId:1,value:26},{id:2,assignmentId:2,value:35},{id:3,assignmentId:3,value:57}]},{id:2,firstName:"Lianna",lastName:"Congrains",finalGrade:0,assignments:[{id:4,assignmentId:1,value:15},{id:5,assignmentId:2,value:15},{id:6,assignmentId:3,value:17}]},{id:3,firstName:"Andy",lastName:"Dirkse",finalGrade:0,assignments:[{id:7,assignmentId:1,value:35},{id:8,assignmentId:2,value:55},{id:9,assignmentId:3,value:58}]},{id:5,firstName:"Jacob",lastName:"Hammer",finalGrade:0,assignments:[{id:13,assignmentId:1,value:26},{id:14,assignmentId:2,value:51},{id:15,assignmentId:3,value:57}]},{id:5,firstName:"Maria",lastName:"Hadrin",finalGrade:0,assignments:[{id:10,assignmentId:1,value:45},{id:11,assignmentId:2,value:75},{id:12,assignmentId:3,value:87}]},{id:6,firstName:"Salma",lastName:"Ortega",finalGrade:0,assignments:[{id:10,assignmentId:1,value:45},{id:11,assignmentId:2,value:75},{id:12,assignmentId:3,value:87}]},{id:14,firstName:"Vincent",lastName:"Rose",finalGrade:0,assignments:[{id:10,assignmentId:1,value:45},{id:11,assignmentId:2,value:75},{id:12,assignmentId:3,value:87}]},{id:24,firstName:"Allen",lastName:"West",finalGrade:0,assignments:[{id:10,assignmentId:1,value:45},{id:11,assignmentId:2,value:75},{id:12,assignmentId:3,value:87}]}]}}}},get:{method:"GET",isArray:!0,interceptor:{responseError:function(a){return c.error("GET CLASSES AND SECTIONS:",a),[{name:"Algebra II",sections:[{id:1,name:"Period 1"},{id:2,name:"Period 2"},{id:3,name:"Period 3"},{id:4,name:"Period 4"}]},{name:"Algebra I",sections:[{id:5,name:"Period 1"},{id:6,name:"Period 2"}]},{name:"Geometry 10",sections:[{id:7,name:"Period 1"},{id:8,name:"Period 2"}]}]}}}})}]),angular.module("gradeBookApp.services").factory("coursesFactory",["appConfig","$resource",function(a,b){return b(a.apiUrl+"/courses/:courseId/ ",{courseId:"@courseId"},{create:{method:"POST"},update:{method:"PUT"}})}]),angular.module("gradeBookApp.services").factory("gradeFactory",["appConfig","$resource",function(a,b){return b(a.apiUrl+"/grades/:gradeId/ ",{gradeId:"@gradeId"},{create:{method:"POST"},update:{method:"PUT"}})}]),angular.module("gradeBookApp.services").factory("sectionFactory",["appConfig","$resource",function(a,b){return b(a.apiUrl+"sections/:sectionId/ ",{sectionId:"@sectionId"},{create:{method:"POST"},update:{method:"PUT"}})}]),angular.module("gradeBookApp.services").factory("studentFactory",["appConfig","$resource","$log",function(a,b,c){return b(a.apiUrl+"/student/:studentId/ ",{studentId:"@studentId"},{update:{method:"PUT"},get:{method:"GET",interceptor:{responseError:function(a){return c.error("GET SINGLE USER:",a),{id:1,firstName:"Ashor",lastName:"Lior",finalGrade:0,assignments:[{id:1,assignmentId:1,value:26},{id:2,assignmentId:2,value:35},{id:3,assignmentId:3,value:57}]}}}}})}]),angular.module("gradeBookApp.templates",["studentGrades/classSectionList/classSectionList.html","studentGrades/singleSection/_addNewAssignment.html","studentGrades/singleSection/_adjustGradeSettings.html","studentGrades/singleSection/singleSection.html"]),angular.module("studentGrades/classSectionList/classSectionList.html",[]).run(["$templateCache",function(a){a.put("studentGrades/classSectionList/classSectionList.html",'<div class="row"><h2>Student grades</h2></div><div class="row"><h3>Please select teacher and year</h3></div><div class="row field"><label class="inline one column year-teacher">Year</label><div class="picker two columns"><select ng-model="select.year" ng-options="year as year for year in years"><option value="">Select year</option></select></div></div><div class="row field"><label class="inline one column year-teacher">Teacher</label><div class="picker two columns"><select ng-model="select.teacher" ng-options="teacher for teacher in teachers"><option value="">Select teacher</option></select></div></div><div class="row" ng-if="select.teacher && select.year"><h3>select a class section to edit grades</h3><table class="rounded"><thead><tr><th>CLASSES</th><th>SECTIONS</th></tr></thead><tbody ng-repeat="classSection in classSectionList"><tr ng-repeat="section in classSection.sections"><td rowspan="{{classSection.sections.length}}" ng-if="$index == 0">{{classSection.name}}</td><td><a ng-href="#/students/classSections/{{section.id}}">{{section.name}}</a></td></tr></tbody></table></div>')}]),angular.module("studentGrades/singleSection/_addNewAssignment.html",[]).run(["$templateCache",function(a){a.put("studentGrades/singleSection/_addNewAssignment.html",'<div class="modal active"><div class="content"><div class="modal-header"><h2 class="modal-title text-center">Add new assignment</h2></div><div class="modal-body"><form class="form-horizontal"><div class="row field"><label class="inline two columns year-teacher">Name</label><div class="seven columns"><input type="text" style="width: 100%" class="input" ng-model="assignment.name" placeholder="enter assignment title name"></div></div><div class="row field"><label class="two columns inline year-teacher">Weight</label><div class="seven columns"><input type="text" style="width: 100%" class="input" ng-model="assignment.weight" placeholder="enter assignment weight as a percentage"></div></div><div class="row"><label class="two columns inline year-teacher">Category</label><div class="seven columns picker"><select class="form-control" ng-model="assignment.category" ng-options="category.id as category.name for category in categories"><option value="">Select category</option></select></div></div></form></div><div class="row"><div class="ten columns centered text-center"><div class="btn primary medium"><a ng-click="ok()">OK</a></div><div class="btn warning medium"><a ng-click="cancel()">Cancel</a></div></div></div></div></div>')}]),angular.module("studentGrades/singleSection/_adjustGradeSettings.html",[]).run(["$templateCache",function(a){a.put("studentGrades/singleSection/_adjustGradeSettings.html",'<div class="modal active"><div class="content"><div class="modal-header"><h2 class="modal-title text-center">Adjust grade settings</h2></div><div class="modal-body"><form class="form-horizontal"><div class="row field" ng-repeat="assignment in assignments"><label class="inline three columns year-teacher">{{assignment.name}}</label><div class="three columns append"><input type="text" class="input text-right" style="margin-top: -2px" ng-model="assignment.weight" placeholder="enter weight"> <span class="adjoined" id="basic-addon2">%</span></div></div></form></div><div class="row"><div class="ten columns centered text-center"><div class="btn primary medium"><a ng-click="ok()">Save</a></div><div class="btn warning medium"><a ng-click="cancel()">Cancel</a></div></div></div></div></div>')}]),angular.module("studentGrades/singleSection/singleSection.html",[]).run(["$templateCache",function(a){a.put("studentGrades/singleSection/singleSection.html",'<div class=""><hot-table afterchange="afterChange" aftergetcolheader="afterGetColHeader" rowheaders="true" colheaders="true" datarows="users" columns="columns" fixedcolumnsleft="3" minsparerows="1" minsparecols="1"></hot-table></div><div style="margin-top: 20px"><div class="btn primary medium"><a ng-href="#/students/classSections">View courses & sections</a></div></div>')}]);